<!DOCTYPE html>
<html>
<head>
    <title>Sistema Produtos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; padding: 20px; }
        input, button { padding: 10px; margin: 5px; }
        .produto { border: 1px solid #ccc; padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üõí Sistema de Produtos</h1>
    
    <div id="status">Carregando...</div>
    
    <div>
        <h3>‚ûï Novo Produto</h3>
        <input type="text" id="nome" placeholder="Nome">
        <input type="number" id="preco" placeholder="Pre√ßo" step="0.01">
        <button onclick="cadastrar()">Cadastrar</button>
    </div>
    
    <div id="produtos" style="margin-top: 20px;"></div>

    <script>
        const SUPABASE_URL = 'https://epcbuzoyhoksyqgtruyr.supabase.co'
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVwY2J1em95aG9rc3lxZ3RydXlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMDM2MjgsImV4cCI6MjA4NTg3OTYyOH0.0EJEG5n06RJSrXfNzbkR7LVgtUSppScogSLmGYRclD0'
        
        // FUN√á√ÉO PARA BUSCAR DADOS
        async function carregarProdutos() {
            document.getElementById('status').innerHTML = 'Carregando...'
            
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/produtos?apikey=${SUPABASE_KEY}&select=*&order=id.desc`,
                    {
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'apikey': SUPABASE_KEY
                        }
                    }
                )
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`)
                }
                
                const dados = await response.json()
                
                if (dados.length === 0) {
                    document.getElementById('produtos').innerHTML = '<p>Nenhum produto cadastrado.</p>'
                } else {
                    let html = '<h3>üì¶ Produtos:</h3>'
                    dados.forEach(p => {
                        html += `
                            <div class="produto">
                                <strong>${p.nome}</strong><br>
                                R$ ${p.preco} | Estoque: ${p.estoque}
                            </div>
                        `
                    })
                    document.getElementById('produtos').innerHTML = html
                }
                
                document.getElementById('status').innerHTML = `‚úÖ ${dados.length} produtos carregados`
                
            } catch (erro) {
                document.getElementById('status').innerHTML = `‚ùå Erro: ${erro.message}`
                console.error('Erro detalhado:', erro)
            }
        }
        
        // FUN√á√ÉO PARA CADASTRAR
        async function cadastrar() {
            const nome = document.getElementById('nome').value
            const preco = document.getElementById('preco').value
            
            if (!nome || !preco) {
                alert('Preencha nome e pre√ßo!')
                return
            }
            
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/produtos?apikey=${SUPABASE_KEY}`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'apikey': SUPABASE_KEY,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify([{
                            nome: nome,
                            preco: parseFloat(preco),
                            estoque: 0
                        }])
                    }
                )
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`)
                }
                
                // Limpa e recarrega
                document.getElementById('nome').value = ''
                document.getElementById('preco').value = ''
                
                carregarProdutos()
                
            } catch (erro) {
                document.getElementById('status').innerHTML = `‚ùå Erro ao cadastrar: ${erro.message}`
            }
        }
        
        // INICIA
        carregarProdutos()
    </script>
</body>
</html>
